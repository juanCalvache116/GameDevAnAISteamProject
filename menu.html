<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Drowned Heart - Main Menu</title>
    <style>
        * {
            box-sizing: border-box;
        }
        
        body {
            margin: 0;
            padding: 0;
            background: #0a1428;
            font-family: 'Courier New', monospace;
            overflow: hidden;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
        }
        
        /* Splash Screen */
        .splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #0a1428;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 1;
            transition: opacity 1.5s ease-out;
        }
        
        .splash-screen.fade-out {
            opacity: 0;
            pointer-events: none;
        }
        
        .splash-logo {
            max-width: 600px;
            width: 90%;
            height: auto;
            margin-bottom: 3rem;
            filter: drop-shadow(0 0 20px rgba(135, 206, 235, 0.6));
            animation: 
                logoGlow 4s ease-in-out infinite alternate,
                logoFloat 6s ease-in-out infinite,
                logoSway 8s ease-in-out infinite alternate;
        }
        
        @keyframes logoGlow {
            from { 
                filter: drop-shadow(0 0 20px rgba(135, 206, 235, 0.6));
            }
            to { 
                filter: drop-shadow(0 0 30px rgba(135, 206, 235, 0.9)) drop-shadow(0 0 60px rgba(70, 130, 180, 0.4));
            }
        }
        
        @keyframes logoFloat {
            0%, 100% { 
                transform: translateY(0px) translateX(0px);
            }
            25% { 
                transform: translateY(-8px) translateX(2px);
            }
            50% { 
                transform: translateY(-12px) translateX(0px);
            }
            75% { 
                transform: translateY(-5px) translateX(-2px);
            }
        }
        
        @keyframes logoSway {
            0%, 100% { 
                transform: rotate(0deg) scale(1);
            }
            50% { 
                transform: rotate(1deg) scale(1.02);
            }
        }
        
        .splash-prompt {
            font-size: 1.4rem;
            color: #F4A460;
            text-shadow: 2px 2px 0px #1a365d;
            animation: promptPulse 2s ease-in-out infinite;
            font-style: italic;
            font-family: 'Georgia', serif;
        }
        
        @keyframes promptPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }
        
        /* Main Menu - initially hidden */
        .main-menu {
            opacity: 0;
            transform: translateY(30px);
            transition: all 1.5s ease-out;
            transition-delay: 0.5s;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            width: 100%;
            position: relative;
            z-index: 10;
        }
        
        .main-menu.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        /* WebGL Shader Canvas */
        #shaderCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0;
            transition: opacity 2s ease-in;
        }
        
        #shaderCanvas.show {
            opacity: 0.8;
        }
        
        /* Main menu logo */
        .main-logo {
            max-width: 400px;
            width: 70%;
            height: auto;
            margin-bottom: 1rem;
            filter: drop-shadow(0 0 15px rgba(135, 206, 235, 0.5));
            animation: 
                mainLogoGlow 4s ease-in-out infinite alternate,
                mainLogoFloat 7s ease-in-out infinite,
                mainLogoBreath 5s ease-in-out infinite alternate;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .main-logo:hover {
            animation-play-state: paused;
            transform: scale(1.05) translateY(-3px);
            filter: drop-shadow(0 0 30px rgba(135, 206, 235, 0.8)) drop-shadow(0 0 60px rgba(70, 130, 180, 0.4));
        }
        
        @keyframes mainLogoGlow {
            from { 
                filter: drop-shadow(0 0 15px rgba(135, 206, 235, 0.5));
            }
            to { 
                filter: drop-shadow(0 0 25px rgba(135, 206, 235, 0.8)) drop-shadow(0 0 50px rgba(70, 130, 180, 0.3));
            }
        }
        
        @keyframes mainLogoFloat {
            0%, 100% { 
                transform: translateY(0px) translateX(0px);
            }
            33% { 
                transform: translateY(-6px) translateX(1px);
            }
            66% { 
                transform: translateY(-3px) translateX(-1px);
            }
        }
        
        @keyframes mainLogoBreath {
            0%, 100% { 
                transform: scale(1) rotate(0deg);
            }
            50% { 
                transform: scale(1.01) rotate(0.5deg);
            }
        }
        
        .subtitle {
            font-size: 1.1rem;
            color: #F4A460;
            text-shadow: 2px 2px 0px #1a365d;
            margin-bottom: 1.5rem;
            text-align: center;
            font-style: italic;
            font-family: 'Georgia', serif;
            opacity: 0.9;
        }
        
        /* Menu container - simplified */
        .menu-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            padding: 1rem;
            width: 100%;
            max-width: 400px;
        }
        
        /* Menu buttons */
        .menu-item {
            display: block;
            width: 320px;
            padding: 18px 35px;
            margin: 0;
            background: linear-gradient(135deg, #1e3a5f, #2c5282);
            color: #F4A460;
            text-decoration: none;
            text-align: center;
            font-size: 1.4rem;
            font-weight: bold;
            border: 3px solid #4682B4;
            border-radius: 12px;
            text-shadow: 2px 2px 0px #1a365d;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            font-family: 'Georgia', serif;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            z-index: 100;
        }
        
        .menu-item:before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(135, 206, 235, 0.3), transparent);
            transition: left 0.5s;
        }
        
        .menu-item:hover {
            background: linear-gradient(135deg, #2c5282, #4682B4);
            box-shadow: 0 6px 20px rgba(135, 206, 235, 0.4);
            transform: translateY(-3px);
            border-color: #87CEEB;
            color: #87CEEB;
        }
        
        .menu-item:hover:before {
            left: 100%;
        }
        
        .menu-item:active {
            transform: translateY(0px);
            box-shadow: 0 0 10px rgba(135, 206, 235, 0.4);
        }
        
        /* Special styling for different menu items */
        .menu-item.start-game {
            background: linear-gradient(135deg, #4682B4, #87CEEB);
            animation: pulse 2s infinite;
            color: #ffffff;
            font-weight: bolder;
            text-shadow: 
                2px 2px 0px #1a365d,
                0px 0px 10px rgba(26, 54, 93, 0.8);
            box-shadow: 0 6px 20px rgba(70, 130, 180, 0.4);
            transform: scale(1.05);
        }
        
        @keyframes pulse {
            0% { 
                box-shadow: 0 6px 20px rgba(70, 130, 180, 0.4), 0 0 0 0 rgba(135, 206, 235, 0.7);
            }
            70% { 
                box-shadow: 0 6px 20px rgba(70, 130, 180, 0.4), 0 0 0 15px rgba(135, 206, 235, 0);
            }
            100% { 
                box-shadow: 0 6px 20px rgba(70, 130, 180, 0.4), 0 0 0 0 rgba(135, 206, 235, 0);
            }
        }
        
        .menu-item.start-game:hover {
            background: linear-gradient(135deg, #87CEEB, #B0E0E6);
            color: #ffffff;
            text-shadow: 
                2px 2px 0px #1a365d,
                0px 0px 15px rgba(26, 54, 93, 0.9);
            transform: scale(1.08);
            box-shadow: 0 8px 25px rgba(135, 206, 235, 0.6);
        }
        
        /* Footer */
        .footer {
            position: absolute;
            bottom: 20px;
            color: #F4A460;
            font-size: 0.9rem;
            text-shadow: 1px 1px 0px #1a365d;
            font-style: italic;
        }
        

        

        

        

        

        

        
        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.95);
            border: 3px solid #4682B4;
            border-radius: 15px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 0 30px rgba(135, 206, 235, 0.5);
        }
        
        .modal-header {
            color: #87CEEB;
            font-size: 2rem;
            font-weight: bold;
            text-align: center;
            margin-bottom: 20px;
            text-shadow: 2px 2px 0px #1a365d;
            font-family: 'Georgia', serif;
        }
        
        .modal-body {
            color: #F4A460;
            font-size: 1.1rem;
            line-height: 1.6;
            text-shadow: 1px 1px 0px #1a365d;
        }
        
        .modal-body h3 {
            color: #87CEEB;
            margin-top: 25px;
            margin-bottom: 15px;
            font-family: 'Georgia', serif;
        }
        
        .modal-body ul {
            padding-left: 20px;
        }
        
        .modal-body li {
            margin-bottom: 8px;
        }
        
        .close-btn {
            position: absolute;
            top: 10px;
            right: 20px;
            color: #87CEEB;
            font-size: 2rem;
            cursor: pointer;
            transition: color 0.3s ease;
        }
        
        .close-btn:hover {
            color: #F4A460;
        }
        
        .key-combo {
            background: rgba(70, 130, 180, 0.3);
            padding: 2px 8px;
            border-radius: 4px;
            border: 1px solid #4682B4;
            font-family: 'Courier New', monospace;
            color: #87CEEB;
        }
        
        /* Custom scrollbar styling */
        .modal-content {
            scrollbar-width: thin;
            scrollbar-color: #4682B4 rgba(0, 0, 0, 0.3);
        }
        
        /* Webkit scrollbar styling */
        .modal-content::-webkit-scrollbar {
            width: 12px;
        }
        
        .modal-content::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            border: 1px solid rgba(70, 130, 180, 0.2);
        }
        
        .modal-content::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #4682B4, #2c5282);
            border-radius: 8px;
            border: 2px solid rgba(0, 0, 0, 0.3);
            box-shadow: 0 2px 4px rgba(135, 206, 235, 0.3);
        }
        
        .modal-content::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, #87CEEB, #4682B4);
            box-shadow: 0 2px 8px rgba(135, 206, 235, 0.5);
        }
        
        .modal-content::-webkit-scrollbar-thumb:active {
            background: linear-gradient(180deg, #87CEEB, #5a9fd4);
        }
        
        .modal-content::-webkit-scrollbar-corner {
            background: rgba(0, 0, 0, 0.3);
        }
        
        /* Responsive adjustments */
        @media (max-height: 700px) {
            .main-logo {
                max-width: 300px;
                width: 60%;
                margin-bottom: 0.5rem;
            }
            .subtitle {
                font-size: 1rem;
                margin-bottom: 1rem;
            }
            .menu-container {
                gap: 15px;
            }
            .menu-item {
                padding: 15px 30px;
                font-size: 1.3rem;
            }
        }
        
        @media (max-width: 480px) {
            .menu-item {
                width: 280px;
                font-size: 1.2rem;
            }
        }
    </style>
</head>
<body>
    <!-- Splash Screen -->
    <div id="splashScreen" class="splash-screen">
        <img src="assets/img/logo.png" alt="Drowned Heart" class="splash-logo">
        <div class="splash-prompt">Press any key to start...</div>
    </div>
    
    <!-- Underwater Shader Background -->
    <canvas id="shaderCanvas"></canvas>
    
    <!-- Background Music -->
    <audio id="menuMusic" loop>
        <source src="assets/ost/menu.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>
    
    <!-- Main Menu Content -->
    <div id="mainMenu" class="main-menu">
        <img src="assets/img/logo.png" alt="Drowned Heart" class="main-logo" onclick="window.location.href='game.html'" title="Click to start game">
        <div class="subtitle">A Cursed Tale of Love and Betrayal</div>
    
    <div class="menu-container">
        <a href="game.html" class="menu-item start-game">
            ⚔️ START GAME
        </a>
        
        <a href="#" class="menu-item" onclick="showLoadGame()">
            📜 LOAD GAME
        </a>
        
        <a href="#" class="menu-item" onclick="showOptions()">
            ⚙️ OPTIONS
        </a>
        
        <a href="#" class="menu-item" onclick="confirmExit()">
            🚪 QUIT GAME
        </a>
    </div>
    
    <!-- Modal for Options -->
    <div id="optionsModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal('optionsModal')">&times;</span>
            <div class="modal-header">⚙️ Ship Options</div>
            <div class="modal-body">
                <h3>🎮 Graphics Settings</h3>
                <ul>
                    <li><strong>Shader Quality:</strong> High (Underwater Caustics)</li>
                    <li><strong>Resolution:</strong> Adaptive</li>
                    <li><strong>Frame Rate:</strong> 60 FPS Target</li>
                </ul>
                
                <h3>🔊 Audio Settings</h3>
                <ul>
                    <li><strong>Background Music:</strong> Enabled</li>
                    <li><strong>Sound Effects:</strong> Enabled</li>
                    <li><strong>Volume:</strong> 50%</li>
                </ul>
                
                <h3>🗺️ Controls</h3>
                <ul>
                    <li><span class="key-combo">WASD</span> or <span class="key-combo">Arrow Keys</span> - Navigate the cursed island</li>
                    <li><span class="key-combo">E</span> - Absorb/Transfer amulet essence</li>
                    <li><span class="key-combo">F</span> - Interact with objects</li>
                    <li><span class="key-combo">Mouse</span> - Menu navigation</li>
                </ul>
                
                <h3>⚡ Gameplay</h3>
                <ul>
                    <li><strong>Difficulty:</strong> Treacherous Waters</li>
                    <li><strong>Auto-save:</strong> Captain's Log Enabled</li>
                    <li><strong>Tutorial:</strong> Available</li>
                </ul>
                
                <p style="margin-top: 25px; font-style: italic; color: #87CEEB;">
                    "Configure your vessel for the cursed voyage ahead..."
                </p>
            </div>
        </div>
    </div>
    
    <script>
        // Audio system
        const menuMusic = document.getElementById('menuMusic');
        let volume = 0.5;
        let splashMode = true;
        
        // WebGL Shader Setup
        let canvas, gl, program, startTime;
        
        function initShader() {
            canvas = document.getElementById('shaderCanvas');
            gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
            
            if (!gl) {
                console.log('WebGL not supported, falling back to solid background');
                return;
            }
            
            // Vertex shader
            const vertexShaderSource = `
                attribute vec2 a_position;
                void main() {
                    gl_Position = vec4(a_position, 0.0, 1.0);
                }
            `;
            
            // Fragment shader (converted from Shadertoy)
            const fragmentShaderSource = `
                precision highp float;
                uniform vec2 u_resolution;
                uniform float u_time;
                
                float length2(vec2 p){
                    return dot(p,p);
                }
                
                float noise(vec2 p){
                    return fract(sin(fract(sin(p.x) * (43.13311)) + p.y) * 31.0011);
                }
                
                float worley(vec2 p) {
                    float d = 1e30;
                    for (int xo = -1; xo <= 1; ++xo) {
                        for (int yo = -1; yo <= 1; ++yo) {
                            vec2 tp = floor(p) + vec2(float(xo), float(yo));
                            d = min(d, length2(p - tp - noise(tp)));
                        }
                    }
                    return 3.0*exp(-4.0*abs(2.5*d - 1.0));
                }
                
                float fworley(vec2 p) {
                    return sqrt(sqrt(sqrt(
                        worley(p*5.0 + 0.05*u_time) *
                        sqrt(worley(p * 50.0 + 0.12 + -0.1*u_time)) *
                        sqrt(sqrt(worley(p * -10.0 + 0.03*u_time))))));
                }
                
                void main() {
                    vec2 uv = gl_FragCoord.xy / u_resolution.xy;
                    float t = fworley(uv * u_resolution.xy / 1500.0);
                    t *= exp(-length2(abs(0.7*uv - 1.0)));
                    gl_FragColor = vec4(t * vec3(0.1, 1.1*t, pow(t, 0.5-t)), 1.0);
                }
            `;
            
            // Create and compile shaders
            const vertexShader = createShader(gl, gl.VERTEX_SHADER, vertexShaderSource);
            const fragmentShader = createShader(gl, gl.FRAGMENT_SHADER, fragmentShaderSource);
            
            // Create program
            program = gl.createProgram();
            gl.attachShader(program, vertexShader);
            gl.attachShader(program, fragmentShader);
            gl.linkProgram(program);
            
            if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {
                console.error('Program link error:', gl.getProgramInfoLog(program));
                return;
            }
            
            // Setup geometry (fullscreen quad)
            const positions = [-1, -1, 1, -1, -1, 1, 1, 1];
            const positionBuffer = gl.createBuffer();
            gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);
            gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(positions), gl.STATIC_DRAW);
            
            const positionLocation = gl.getAttribLocation(program, 'a_position');
            gl.enableVertexAttribArray(positionLocation);
            gl.vertexAttribPointer(positionLocation, 2, gl.FLOAT, false, 0, 0);
            
            // Start animation
            startTime = Date.now();
            resizeCanvas();
            animate();
        }
        
        function createShader(gl, type, source) {
            const shader = gl.createShader(type);
            gl.shaderSource(shader, source);
            gl.compileShader(shader);
            
            if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {
                console.error('Shader compile error:', gl.getShaderInfoLog(shader));
                gl.deleteShader(shader);
                return null;
            }
            
            return shader;
        }
        
        function resizeCanvas() {
            if (!canvas || !gl) return;
            
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            gl.viewport(0, 0, canvas.width, canvas.height);
        }
        
        function animate() {
            if (!gl || !program) return;
            
            const currentTime = (Date.now() - startTime) / 1000;
            
            gl.useProgram(program);
            
            // Set uniforms
            const resolutionLocation = gl.getUniformLocation(program, 'u_resolution');
            gl.uniform2f(resolutionLocation, canvas.width, canvas.height);
            
            const timeLocation = gl.getUniformLocation(program, 'u_time');
            gl.uniform1f(timeLocation, currentTime);
            
            // Draw
            gl.clearColor(0.04, 0.08, 0.16, 1.0);
            gl.clear(gl.COLOR_BUFFER_BIT);
            gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);
            
            requestAnimationFrame(animate);
        }

        // Initialize when page loads
        window.addEventListener('load', function() {
            // Initialize the underwater shader
            initShader();
            
            // Handle window resize
            window.addEventListener('resize', resizeCanvas);
            
            // Set music volume but don't start playing yet
            menuMusic.volume = volume;
        });
        
        // Splash screen transition
        function transitionToMainMenu() {
            if (!splashMode) return;
            console.log('Starting transition to main menu');
            
            splashMode = false;
            const splashScreen = document.getElementById('splashScreen');
            const mainMenu = document.getElementById('mainMenu');
            const shaderCanvas = document.getElementById('shaderCanvas');
            
            console.log('Elements found:', {
                splashScreen: !!splashScreen,
                mainMenu: !!mainMenu,
                shaderCanvas: !!shaderCanvas
            });
            
            // Start the fade out
            splashScreen.classList.add('fade-out');
            
            // Show shader background immediately
            shaderCanvas.classList.add('show');
            
            // Try to start music immediately (user just interacted)
            menuMusic.volume = volume;
            console.log('Attempting to start music...');
            menuMusic.play().then(() => {
                console.log('Music started successfully');
            }).catch(function(error) {
                console.log('Audio autoplay prevented:', error);
                // Try again after menu shows
                setTimeout(() => {
                    console.log('Trying music again...');
                    menuMusic.play().catch(e => console.log('Second music attempt failed:', e));
                }, 1000);
            });
            
            // Show main menu after a delay
            setTimeout(() => {
                console.log('Showing main menu');
                mainMenu.classList.add('show');
                
                // Initialize hover effects after menu is shown
                setTimeout(() => {
                    const menuItems = document.querySelectorAll('.menu-item');
                    console.log('Found menu items:', menuItems.length);
                    menuItems.forEach(item => {
                        item.addEventListener('mouseenter', function() {
                            // Could add eerie creaking or underwater sounds here
                            // underwaterSound.play();
                        });
                    });
                }, 100);
            }, 800);
            
            // Remove splash screen from DOM after transition
            setTimeout(() => {
                console.log('Removing splash screen');
                splashScreen.remove();
            }, 2000);
        }
        
        // Modal functions
        function showLoadGame() {
            console.log('🔄 Load Game functionality pending - save system not yet implemented');
        }
        
        function showOptions() {
            document.getElementById('optionsModal').style.display = 'block';
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        // Close modal when clicking outside
        window.onclick = function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        }
        
        // Keyboard navigation - handle ESC, ENTER, and any key for splash
        document.addEventListener('keydown', function(event) {
            if (event.code === 'Escape') {
                const modals = document.querySelectorAll('.modal');
                let modalOpen = false;
                modals.forEach(modal => {
                    if (modal.style.display === 'block') {
                        modal.style.display = 'none';
                        modalOpen = true;
                    }
                });
                // Only show exit confirmation if no modals are open
                if (!modalOpen && !splashMode) {
                    confirmExit();
                }
            } else if (event.code === 'Enter') {
                if (splashMode) {
                    // Transition from splash to main menu
                    transitionToMainMenu();
                } else {
                    // Begin the cursed voyage
                    window.location.href = 'game.html';
                }
            } else if (splashMode) {
                // Any other key during splash mode transitions to main menu
                transitionToMainMenu();
            }
        });
        
        function confirmExit() {
            if (confirm('🚪 Are you sure you want to quit the game?\n\nYour cursed voyage has only just begun...')) {
                window.close();
            }
        }
        
        // Handle clicks for audio interaction
        document.addEventListener('click', function(event) {
            // Try to start music on any click if it's not playing
            if (!splashMode && menuMusic.paused) {
                menuMusic.volume = volume;
                menuMusic.play().then(() => {
                    console.log('Music started via click');
                }).catch(error => {
                    console.log('Click music start failed:', error);
                });
            }
        });
        

        
        // Ensure smooth loading
        document.body.style.opacity = '1';
    </script>
</body>
</html>
